@startuml Stock Opname Class Diagram

' Styling
skinparam classAttributeIconSize 0
skinparam class {
    BackgroundColor<<boundary>> LightYellow
    BackgroundColor<<control>> LightBlue
    BackgroundColor<<entity>> LightGreen
    BackgroundColor<<service>> LightCyan
}

title Class Diagram - Stock Opname (Implementasi Aktual)

' Boundary (View/UI)
class "stock-opname.blade.php" as StockOpnameView <<boundary>> {
    + tampilkanDaftarProduk()
    + tampilkanFormInputStokFisik()
    + tampilkanStokSaatIni()
}

' Control (Controller)
class StockOpnameController <<control>> {
    - stockService: StockService
    --
    + index()
    + store(Request)
}

' Service
class StockService <<service>> {
    + stockIn(productId, qty, price, type, note)
    + stockOut(productId, qty, price, type, note)
    + stockAdjustment(productId, qtyIn, qtyOut, price, type, note)
    + getCurrentStock(productId): int
    + isStockAvailable(productId, qty): bool
    + reverseStockIn(productId, qty)
    + reverseStockOut(productId, qty)
    # createTransaction(productId, qtyIn, qtyOut, price, type, note): ProductTransaction
    # updateStock(productId, qtyIn, qtyOut): ProductStock
}

' Entity (Domain Model)
class Product <<entity>> {
    - id: Integer
    - name: String
    - description: String
    - price: Decimal
    --
    + productStock(): HasOne
    + productTransactions(): HasMany
}

class ProductStock <<entity>> {
    - product_id: Integer (PK)
    - qty_in: Integer
    - qty_out: Integer
    - current_stock: Integer
    --
    + product(): BelongsTo
}

class ProductTransaction <<entity>> {
    - id: Integer
    - product_id: Integer
    - user_id: Integer
    - qty_in: Integer
    - qty_out: Integer
    - type: String
    - price: Decimal
    - total_price: Decimal
    - note: String
    --
    + product(): BelongsTo
    + user(): BelongsTo
}

class User <<entity>> {
    - id: Integer
    - name: String
    - email: String
}

' Relationships
StockOpnameView --> StockOpnameController : uses
StockOpnameController --> StockService : uses
StockService --> ProductStock : manages
StockService --> ProductTransaction : creates
Product "1" -- "1" ProductStock : has
Product "1" -- "many" ProductTransaction : has
ProductTransaction --> User : references

' Notes
note right of StockService
  **Logika Stock Opname:**

  1. Hitung selisih:
     diff = counted_stock - current_stock

  2. Penyesuaian:
     if diff > 0: stockIn(productId, diff, 0, 'stock_opname', note)
     if diff < 0: stockOut(productId, abs(diff), 0, 'stock_opname', note)
     if diff = 0: tidak ada perubahan
end note

note bottom of ProductTransaction
  **Type untuk Stock Opname:**
  type = 'stock_opname'

  Transaksi dicatat dengan:
  - qty_in > 0 (jika kelebihan)
  - qty_out > 0 (jika kekurangan)
end note

@enduml
