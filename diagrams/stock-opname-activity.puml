@startuml Stock Opname Activity Diagram

' Styling
skinparam activityBackgroundColor LightBlue
skinparam activityBorderColor Black
skinparam activityDiamondBackgroundColor LightYellow
skinparam activityStartColor Green
skinparam activityEndColor Red

title Activity Diagram - Proses Stock Opname

|User|
start
:Login ke sistem;
:Buka menu Stock Opname;

|System|
:Load daftar produk dengan stok;
:Tampilkan halaman stock opname;

|User|
:Pilih produk yang akan dihitung;
:Lihat stok sistem saat ini;
note right
  Contoh: Produk A
  Current Stock: 100 unit
end note

:Pergi ke gudang;
:Hitung stok fisik produk;
:Input jumlah counted_stock;
note right
  User input: 95 unit
end note

if (Perlu tambah catatan?) then (Ya)
  :Input catatan/keterangan;
  note right
    Contoh: "Barang rusak"
    "Selisih karena kehilangan"
  end note
else (Tidak)
endif

:Klik "Submit Stock Opname";

|System|
:Validasi input;
note right
  - product_id harus valid
  - counted_stock >= 0
  - note opsional (max 255 char)
end note

if (Validasi berhasil?) then (Ya)
  :Mulai database transaction;

  :Ambil current_stock dari ProductStock;
  :Hitung selisih stok;
  note right
    diff = counted_stock - current_stock
    diff = 95 - 100 = -5
  end note

  if (diff = 0?) then (Ya)
    #LightGreen:Tidak ada penyesuaian diperlukan;
  else if (diff > 0?) then (Ya)
    #LightYellow:Panggil stockIn();
    note right
      stockIn(productId, diff, 0, 'stock_opname', note)
      - Tambah stok karena kelebihan
    end note
    :Buat ProductTransaction (qty_in);
    :Update ProductStock (tambah qty_in);
  else (diff < 0)
    #LightCoral:Panggil stockOut();
    note right
      stockOut(productId, abs(diff), 0, 'stock_opname', note)
      - Kurangi stok karena kekurangan
    end note
    :Buat ProductTransaction (qty_out);
    :Update ProductStock (tambah qty_out);
  endif

  :Commit database transaction;

  |User|
  :Lihat pesan sukses;
  :Redirect ke halaman stock opname;

else (Tidak)
  |User|
  :Lihat pesan error validasi;
  :Kembali ke form dengan input sebelumnya;
endif

stop

@enduml
